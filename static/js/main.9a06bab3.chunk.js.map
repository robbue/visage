{"version":3,"sources":["styles.js","Tracker.js","App.js","index.js"],"names":["AppContainer","styled","div","header","h1","img","p","Button","button","Canvas","canvas","Tracker","props","state","sdkLoaded","width","height","threshold","licenseName","licenseURL","$canvas","React","createRef","_loaded","bind","_initStream","_canPlayStream","_tick","window","callbackDownload","this","visageModule","VisageModule","onRuntimeInitialized","locateFile","dataFileName","preRun","push","FS_createPreloadedFile","console","error","initializeLicenseManager","m_Tracker","VisageTracker","faceDataArray","FaceDataVector","faceData","FaceData","push_back","mWidth","current","mHeight","ppixels","_malloc","pixels","Uint8ClampedArray","HEAPU8","buffer","canvasContext","getContext","eyesClosed","eyesClosedCounter","setState","stream","$video","document","createElement","navigator","mediaDevices","getUserMedia","video","audio","addEventListener","loop","muted","autoplay","srcObject","load","_errorStream","startTracking","draw","removeEventListener","play","requestAnimationFrame","drawImage","imageData","getImageData","data","i","length","trackerReturnState","track","VisageTrackerImageFormat","VISAGE_FRAMEGRABBER_FMT_RGBA","value","VisageTrackerOrigin","VISAGE_FRAMEGRABBER_ORIGIN_TL","VisageTrackerStatus","TRACK_STAT_OK","closedEyes","getEyeClosure","log","Fragment","onClick","ref","Component","GlobalStyle","createGlobalStyle","App","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.9a06bab3.chunk.js","sourcesContent":["import styled from 'styled-components';\n\nexport const AppContainer = styled.div`\n text-align: center;\n`;\n\nexport const AppHeader = styled.header`\n background-color: #222;\n height: 150px;\n padding: 20px;\n color: white;\n`;\n\nexport const AppTitle = styled.h1`\n   font-size: 1.5em;\n`;\n\nexport const AppLogo = styled.img`\n animation: App-logo-spin infinite 20s linear;\n height: 80px;\n @keyframes App-logo-spin {\n   from { transform: rotate(0deg); }\n   to { transform: rotate(360deg); }\n }\n`;\n\nexport const AppIntro = styled.p`\n font-size: large;\n`;\n","import React from 'react';\nimport styled from 'styled-components';\n\nconst Button = styled.button``;\nconst Canvas = styled.canvas``;\n\nclass Tracker extends React.Component {\n\tconstructor (props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t\tsdkLoaded: false,\n\t\t\twidth: 320,\n\t\t\theight: 240,\n\t\t\tthreshold: 15,\n\t\t\tlicenseName: '606-555-833-692-564-758-653-442-720-253-644.vlc',\n\t\t\tlicenseURL: 'lib/606-555-833-692-564-758-653-442-720-253-644.vlc'\n\t\t};\n\n\t\tthis.$canvas = React.createRef();\n\n\t\tthis._loaded = this._loaded.bind(this);\n\t\tthis._initStream = this._initStream.bind(this);\n\t\tthis._canPlayStream = this._canPlayStream.bind(this);\n\t\tthis._tick = this._tick.bind(this);\n\n\t\twindow.callbackDownload = this._loaded;\n\t}\n\n\tcomponentDidMount () {\n\t\tvar locateFile = function (dataFileName) {\n\t\t\tvar relativePath = 'lib/' + dataFileName;\n\t\t\treturn relativePath;\n\t\t};\n\n\t\tthis.visageModule = window.VisageModule({\n\t\t\tonRuntimeInitialized: this._loaded,\n\t\t\tlocateFile: locateFile\n\t\t});\n\n\t\tvar preloadFiles = () => {\n\t\t\tthis.visageModule.FS_createPreloadedFile('/', 'FFT-High.cfg', 'lib/Facial Features Tracker - High.cfg', true, false);\n\t\t\tthis.visageModule.FS_createPreloadedFile('/', this.state.licenseName, this.state.licenseURL, true, false, function () {}, function () { console.error('Loading License Failed!'); });\n\t\t};\n\n\t\tthis.visageModule.preRun.push(preloadFiles);\n\t}\n\n\t_loaded () {\n\t\t// license\n\t\tthis.visageModule.initializeLicenseManager(this.state.licenseName);\n\n\t\tthis.m_Tracker = new this.visageModule.VisageTracker('FFT-High.cfg');\n\n\t\t// Instantiate the face data object\n\t\tthis.faceDataArray = new this.visageModule.FaceDataVector();\n\t\tthis.faceData = new this.visageModule.FaceData();\n\t\tthis.faceDataArray.push_back(this.faceData);\n\n\t\tthis.mWidth = this.$canvas.current.width;\n\t\tthis.mHeight = this.$canvas.current.height;\n\n\t\t// Allocate memory for image data\n\t\tthis.ppixels = this.visageModule._malloc(this.mWidth * this.mHeight * 4);\n\n\t\t// Create a view to the memory\n\t\tthis.pixels = new Uint8ClampedArray(this.visageModule.HEAPU8.buffer, this.ppixels, this.mWidth * this.mHeight * 4);\n\n\t\t// Canvas ctx\n\t\tthis.canvasContext = this.$canvas.current.getContext('2d');\n\n\t\tthis.eyesClosed = false;\n\t\tthis.eyesClosedCounter = 0;\n\n\t\t// Show Start button\n\t\tthis.setState({ sdkLoaded: true });\n\t}\n\n\tasync _initStream () {\n\t\tlet stream = null;\n\t\tthis.$video = document.createElement('video');\n\n\t\ttry {\n\t\t\tstream = await navigator.mediaDevices.getUserMedia({\n\t\t\t\tvideo: true,\n\t\t\t\taudio: false\n\t\t\t});\n\n\t\t\tthis.$video.addEventListener('canplay', this._canPlayStream);\n\t\t\tthis.$video.loop = this.$video.muted = this.$video.autoplay = true;\n\t\t\tthis.$video.srcObject = stream;\n\t\t\tthis.$video.load();\n\t\t} catch (error) {\n\t\t\tthis._errorStream(error);\n\t\t}\n\t}\n\n\t_errorStream (error) {\n\t\tif (error) console.error(error);\n\t}\n\n\t_canPlayStream (stream) {\n\t\tthis.startTracking = true;\n\t\tthis.draw = true;\n\n\t\tthis.$video.removeEventListener('canplay', this._canPlayStream);\n\n\t\tthis.$video.play();\n\n\t\tthis.$canvas.current.width = this.state.width;\n\t\tthis.$canvas.current.height = this.state.height;\n\n\t\tthis.mWidth = this.state.width;\n\t\tthis.mHeight = this.state.height;\n\n\t\t// setTimeout(this._tick, 1000);\n\t\tthis._tick();\n\t}\n\n\t_tick () {\n\t\twindow.requestAnimationFrame(this._tick);\n\n\t\tthis.canvasContext.drawImage(this.$video, 0, 0, this.mWidth, this.mHeight);\n\n\t\t// Access pixel data\n\t\tthis.imageData = this.canvasContext.getImageData(0, 0, this.mWidth, this.mHeight).data;\n\n\t\t// Clear canvas\n\t\t// this.canvasContext.clearRect(0, 0, this.$canvas.current.width, this.$canvas.current.height);\n\n\t\t// Save pixel data to preallocated buffer\n\t\tfor (let i = 0; i < this.imageData.length; i += 4) {\n\t\t\tthis.pixels[i] = this.imageData[i];\n\t\t}\n\n\t\t// console.log({\n\t\t// \treadyStatus: this.visageModule.VisageTrackerStatus.TRACK_STAT_OK.value,\n\t\t// \tgetConfiguration: this.m_Tracker.getConfiguration(),\n\t\t// \tmWidth: this.mWidth,\n\t\t// \tmHeight: this.mHeight,\n\t\t// \tppixels: this.ppixels,\n\t\t// \tfaceData: this.faceDataArray,\n\t\t// \tVISAGE_FRAMEGRABBER_FMT_RGBA: this.visageModule.VisageTrackerImageFormat.VISAGE_FRAMEGRABBER_FMT_RGBA.value,\n\t\t// \tVISAGE_FRAMEGRABBER_ORIGIN_TL: this.visageModule.VisageTrackerOrigin.VISAGE_FRAMEGRABBER_ORIGIN_TL.value\n\t\t// });\n\n\t\tthis.trackerReturnState = this.m_Tracker.track(\n\t\t\tthis.mWidth,\n\t\t\tthis.mHeight,\n\t\t\tthis.ppixels,\n\t\t\tthis.faceDataArray,\n\t\t\tthis.visageModule.VisageTrackerImageFormat.VISAGE_FRAMEGRABBER_FMT_RGBA.value,\n      this.visageModule.VisageTrackerOrigin.VISAGE_FRAMEGRABBER_ORIGIN_TL.value\n\t\t\t// 0,\n\t\t\t// -1,\n\t\t\t// 1\n\t\t);\n\n\t\t// console.log(this.trackerReturnState && this.trackerReturnState[0]);\n\t\t// console.log(this.faceData.getEyeClosure());\n\n\t\tif (this.trackerReturnState[0] === this.visageModule.VisageTrackerStatus.TRACK_STAT_OK.value) {\n\t\t\tconst closedEyes = this.faceData.getEyeClosure();\n\t\t\t// Index 0 represents closure of left eye. Index 1 represents closure of right eye. Value of 1 represents open eye. Value of 0 represents closed eye.\n\n\t\t\tif (closedEyes[0] === 0 && closedEyes[1] === 0) {\n\t\t\t\tthis.eyesClosedCounter++;\n\n\t\t\t\tif (this.eyesClosedCounter > this.state.threshold) {\n\t\t\t\t\tthis.eyesClosed = true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.eyesClosed = false;\n\t\t\t}\n\n\t\t\tconsole.log({\n\t\t\t\teyesClosed: this.eyesClosed\n\t\t\t});\n\t\t}\n\n\t\t/*\n\t\tNEXT:\n\t\t\t- install howler and gsap\n\t\t\tfade in sound and DOM\n\t\t*/\n\t}\n\n\trender () {\n\t\treturn (\n\t\t\t<React.Fragment>\n\t\t\t\t{this.state.sdkLoaded && <Button onClick={this._initStream}>Start</Button>}\n\t\t\t\t<Canvas ref={this.$canvas} width={this.state.width} height={this.state.height} />\n\t\t\t</React.Fragment>\n\t\t);\n\t}\n}\n\nexport default Tracker;\n","import React from 'react';\nimport styled, { createGlobalStyle } from 'styled-components';\n// import logo from './logo.svg';\nimport { AppContainer } from './styles'; // , AppHeader, AppTitle, AppLogo, AppIntro\nimport Tracker from './Tracker';\n\n// Add global styles\nconst GlobalStyle = createGlobalStyle`\n\tbody {\n\t\tmargin: 0;\n\t\tpadding: 0;\n\t\tfont-family: sans-serif;\n\t}\n`;\n\nexport const Button = styled.button``;\n\nfunction App () {\n\treturn (\n\t\t<React.Fragment>\n\t\t\t<GlobalStyle />\n\t\t\t<AppContainer>\n\t\t\t\t<Tracker />\n\t\t\t</AppContainer>\n\t\t</React.Fragment>\n\t);\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}